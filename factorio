#!/usr/bin/env python3

#==================
# imports
#==================
import tkinter as tk
from tkinter import *
from tkinter import ttk
from tkinter import messagebox as msg

import sys
import os
import json

# Loading Factorio mods externally
with open("mods.json", "r") as json_file:
    json_data = json.load(json_file)
	
mods = json_data
print(mods)

# Create Instance
win = tk.Tk()

# Add Title
win.title("Factorio Games")

# Disable Resizing
win.resizable(False, False)

# Helper Functions
def mbox(mod):
    text = "Launching "+mod
    msg.showinfo("Launching", text)
    
def launch(mod=""):
	launcher = "steam -applaunch 427520"
	if mod:
		launcher = launcher + " --mod-directory ~/.factorio/" + mod
	print(launcher)
	os.system(launcher)
	
def callback(mod):
	mbox(mod + " Factorio")
	launch(mods[mod])
	cancel()

def make_callback(mod):
	return (lambda: callback(mod))

# Factorio Starting Options
def cancel():
    win.quit()
    win.destroy()
    #exit()

# Add Buttons
buttons = []
for mod in mods:
	print(mod + " " + mods[mod])
	button = ttk.Button(win, text=mod+" Factorio", command=make_callback(mod))
	button.pack(fill=X, padx=10, pady=2)

can = ttk.Button(win, text="Cancel", command=cancel)
can.pack(fill=X, padx=10, pady=2)

#==================
# Starting GUI
#==================
win.mainloop()
